# 架构拓扑

## 架构

![image-20201220150149285](https://gitee.com/luoxian1011/pictures/raw/master/image-20201220150149285.png)

| 负载均衡 | 主LB    | 备LB    |        |        |
| -------- | ------- | ------- | ------ | ------ |
| Web层    | tomcat  | tomcat  | tomcat | tomcat |
| 缓存层   | 主redis | 从redis |        |        |
| 数据库   | 主mysql | 从mysql |        |        |

架构主要分为：负载均衡层，WEB层，应用层，缓存层和数据库层

- 前面是负载均衡，使用的是Nginx，采用轮询算法。还有一个搭建了Keepalived，做高可用，防止单点故障。
- Web层使用的是四台Tomcat服务器
- 缓存层使用的是Redis做动态缓存，实现Session共享和常用数据的缓存，减小数据库的压力
- 数据库使用的是Mysql，采用MyCat中间件代理主从数据库，实现数据的读写分离，优化数据库的性能
- 监控采用的是Zabbix，主要监控各个服务器的系统状态，服务状态和Web场景
- 公司网站每天的PV量大概在6000左右

## Nginx优化

1. 编译前隐藏版本
2. 调整工作进程数
3. 使用epoll模型
4. 开启高效传输
5. 配置连接超时时间
6. fastcgi调优
7. 开启gzip压缩和expires缓存调优
8. 防盗链
9. 内核参数优化
10. 系统连接数优化
11. 反向代理和日志切割

## Tomcat优化

1. JVM参数
2. 删除管理后台
3. 禁用目录浏览
4. 隐藏版本信息
5. 脚本权限回收
6. 优化线程池
7. 关闭AJP接口
8. 开启APR模式

## Zabbix监控项

1. 监控网卡流量
2. 监控Mysql状态
3. 监控Mysql主从
4. 监控Nginx状态
5. 自定义模板
6. Web监测
7. 监控Redis状态