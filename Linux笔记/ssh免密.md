# ssh免密

- https://www.cnblogs.com/bingoli/p/10567734.html
- https://blog.51cto.com/u_2915224/2044975

使用ssh登录服务器的时候，需要输入ip地址、端口、用户名、密码等信息，比较麻烦，容易输错。还好，通过客户端和服务器的配置参数，可实现免密码快速登录。服务器可通过保存客户端的公钥，用于验证客户端的身份，从而省去输入密码的步骤。客户端也可通过配置服务器参数来简化登录命令。

本文主要是记录了ssh面密码快速登录的配置过程，主要分为以下几个步骤。

- 客户端生成密钥，包括私钥和公钥。
- 在服务器中配置客户端的公钥。
- 在客户端配置服务器登录相关参数。

本文示例中的服务器ip地址为192.168.1.1，ssh端口为22。

## 客户端生成密钥
ssh-genkey是生成密钥的工具，执行完成后生成公钥和密钥，这两个文件会默认保存在~/.ssh/路径下。常用的参数为：

```
ssh-keygen
-t: 指定生成密钥类型（rsa、dsa）。默认为rsa
-f: 指定存放私钥的文件，公钥文件名为私钥文件名加.pub后缀。默认为id_rsa
-P: 指定passphrase（私钥的密码），用于确保私钥的安全。默认为空
-C: 备注。默认为user@hostname
```

生成密钥过程中，建议采用默认值，只需要按三次回车之后，就会再～/.ssh目录下生成密钥文件

此时，生成的文件在~/.ssh/目录下，我们会看到这些文件：
```
id_rsa    // 私钥文件  
id_rsa.pub    // 公钥文件
authorized_keys    // 存放客户端公钥的文件
known_hosts    // 确认过公钥指纹的可信服务器列表的文件
config    // 指定不同域名使用哪个密钥的配置文件
```

## 上传到服务器
服务器的 ~/.ssh/authorized_keys 文件保存可快速连接的客户端的公钥。

只需把客户端生成的id_rsa.pub文件的内容拷贝到authorized_keys文件的末尾。拷贝的方法有：

直接拷贝。由于 id_rsa.pub 和 authorized_keys 都是文本文件，可通过拷贝命令直接拷贝。
把id_rsa.pub上传到服务器，然后再把内容添加到 authorized_keys 文件中。

### 在客户端把公钥上传到服务器

```
方式一：ssh-copy-id -i ~/.ssh/id_rsa.pub user@server  # 仅支持SSH运行在22端口的情况（-i 参数在默认情况下可省略）

方式二：scp ~/.ssh/id_rsa.pub root@192.168.1.1:~/.ssh/authorized_keys
```


### 在服务器直接追加公钥

```
cat id_rsa.pub >> ~/.ssh/authorized_keys
```


配置好之后，登录服务器就不再需要密码了。 

## 在客户端配置服务器登录相关参数
除了密码之外，登录时，还需要配置ip地址、端口、用户等信息，也比较繁琐。

可通过客户端的~/.ssh/config配置服务器的相关参数简化登录命令。

config文件的配置内容如下：


```
Host server
Hostname 192.168.1.1
Port 22
User bingoli
```


其中，Host为服务器的名称，输入登录命令时使用，后续登录只需要记住这个名字就可以；Hostname为服务器的ip地址；Port为ssh的端口；User为服务器的用户名。

配置好相关参数之后，就可以使用简化的命令登录服务器了。


```
ssh server
```

从此以后，登录服务器就简单多了。