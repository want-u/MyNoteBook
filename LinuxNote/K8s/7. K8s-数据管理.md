# K8s-数据管理

`volume`

我们经常会说：容器和 Pod 是短暂的。
其含义是它们的生命周期可能很短，会被频繁地销毁和创建。容器销毁时，保存在容器内部文件系统中的数据都会被清除。

为了持久化保存容器的数据，可以使用 Kubernetes Volume。

Volume 的生命周期独立于容器，Pod 中的容器可能被销毁和重建，但 Volume 会被保留。

本质上，Kubernetes Volume 是一个目录，这一点与 Docker Volume 类似。当 Volume 被 mount 到 Pod，Pod 中的所有容器都可以访问这个 Volume。Kubernetes Volume 也支持多种 backend 类型，包括 emptyDir、hostPath、GCE Persistent Disk、AWS Elastic Block Store、NFS、Ceph 等，完整列表可参考 https://kubernetes.io/docs/concepts/storage/volumes/#types-of-volumes

Volume 提供了对各种 backend 的抽象，容器在使用 Volume 读写数据的时候不需要关心数据到底是存放在本地节点的文件系统中呢还是云硬盘上。对它来说，所有类型的 Volume 都只是一个目录。

## emptyDir

```
[root@k8s-master ~]# mkdir volumepod
[root@k8s-master ~]# cd !$

[root@k8s-master volumepod]# kubectl run producer-consumer --image=busybox --dry-run="client" -o yaml > producer-consumer.yaml

[root@k8s-master volumepod]# cat producer-consumer.yaml 
apiVersion: v1
kind: Pod
metadata:
  labels:
    run: producer-consumer
  name: producer-consumer
spec:
  containers:
  - image: busybox
    name: producer
    volumeMounts:
    - mountPath: /producer_dir
      name: shared-volume
    args: ["/bin/sh","-c","echo 'hello world' > /producer_dir/hello; sleep 999999"]

  - image: busybox
    name: consumer
    volumeMounts:
    - mountPath: /consumer_dir
      name: shared-volume
    args: ["/bin/sh","-c","cat /consumer_dir/hello; sleep 999999"]


  volumes:
  - name: shared-volume
    emptyDir: {}

[root@k8s-master volumepod]# kubectl apply -f producer-consumer.yaml

[root@k8s-master volumepod]# kubectl get pod -o wide 
NAME                READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES
producer-consumer   2/2     Running   0          62s   10.244.1.98   k8s-node1   <none>           <none>
[root@k8s-master volumepod]# kubectl logs producer-consumer consumer 
hello world

```

