

### **个人技能**

在上家公司主要负责linux服务器的日常维护和故障排查，负责对常用服务的部署，优化还有监控

目前比较熟悉nginx，apache和tomcat 这些常见的web服务，能够编写shell和python脚本辅助进行工作，熟悉lvs，nginx的负载均衡和keepalived的高可用架构，还有mysql数据库的主从和高可用集群的搭建部署，熟悉zabbix监控和ansible自动化运维工具的使用，对kvm虚拟化技术，docker和k8s容器技术也有一定的了解



### **ansible更新10台tomcat**

三步：停止，更新，启动；保证服务运行

ansible常用模块：command shell copy service

ansible-playbook 使用 serial 实现服务滚动更新实例

```
默认情况下，Ansible 将尝试并行管理 playbook 中所有的机器。对于滚动更新用例，可以使用 serial 关键字定义 Ansible 一次应管理多少主机
将 serial 关键字指定为百分比，表示每次并行执行的主机数占总数的比例
将 serial 关键字指定为数字，如 2，表示每次并行执行的主机数为 2，多批次直到执行完成

- hosts: all
  become: yes
  serial: 33%
  gather_facts: no
  tasks:
    - name: Checking group_vars/all.yml
      stat:
        path: group_vars/all.yml
      delegate_to: localhost
      run_once: yes
      become: no
      register: result
    - fail:
        msg: "Please create group_vars/all.yml from group_vars/all.yml.example, and edit it to suit your environment before your deploy."
      when: result.stat.exists == false
      delegate_to: localhost
      run_once: yes
      become: no

- hosts: all
  become: yes
  serial: 33%
  roles:
    - init

```

### **elk收集nginx日志**

- 两组业务，两组日志

- 在filebeat对不同业务日志 创建自定义索引

```
[vim /etc/filebeat/filebeat.yml]

# 定义app、zabbix、nginx等应用的input类型、以及存放的具体路径
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/*.log
  fields: 
    source: app
- type: log
  enabled: true
  paths:
    - /var/log/nginx/*.log
  fields:
    source: nginx
    
filebeat.config.modules:
  path: ${path.config}/modules.d/*.yml
  reload.enabled: true
  
setup.template.settings:
  index.number_of_shards: 1
  
# 定义kibana的IP:PORT
setup.kibana:
  host: "192.168.10.11:5601"

# 定义模板的相关信息  
setup.template.name: "lile_log"
setup.template.pattern: "lile-*"
setup.template.overwrite: true
setup.template.enabled: true
# 在7.4这个版本中，自定义ES的索引需要把ilm设置为false
setup.ilm.enabled: false

# 定义app、zabbix、nginx的output
output.elasticsearch:
  # 定义ES的IP:PORT
  hosts: ["192.168.10.11:9200"]
  # 这里的index前缀lile与模板的pattern匹配，中间这一串设置为field.source变量，方面后面具体的匹配
  index: "lile-%{[fields.source]}-*"
  indices:
    # 这里的前缀lile同为与模板的pattern匹配，中间为field.source具体的值，当前面的input的field.source值与这里的匹配时，则index设置为定义的
    - index: "lile-app-%{+yyyy.MM.dd}"
      when.equals:
        fields:
            source: "app"

    - index: "lile-nginx-%{+yyyy.MM.dd}"
      when.equals: 
        fields.source: "nginx"
  
processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
```

- kibana配置

![img](https://gitee.com/luoxian1011/pictures/raw/master/2018101212062652)



---

### 网络

tcpdump：网络抓包工具

ss / netstat

ip地址：ip addr / ifconfig

路由：添加路由

```
// 添加到主机的路由
# route add –host 192.168.168.110 dev eth0
# route add –host 192.168.168.119 gw 192.168.168.1
```

---

### shell脚本

shell 脚本接收参数： $1 ...  awk {print $NF} 

shell 磁盘占用的报警脚本； 日志切割轮替 mysql备份 服务部署脚本

 shell 三剑客

- awk {print $3}
- sed -i 

- grep 
  - -i 忽略大小写
  - -A 显示匹配行 和 后面的行数，在错误日志查找时还是很有用
  - -a 搜索二进制文件,表示把所有文件当作ASCII文件来处理
  - -e 高级

python脚本：常用库sys，os，time，random，shutil

### top进程负载

top 

- 1、5和15分钟内的平均负载  平均活跃进程数  ，可以用-n N 指定输出次数

- load 20 cpu计算的队列 cpu个数来确定load的临界值；系统识别为8个cpu，那么load为8就是临界点，高于8就属于over load了

- 僵尸进程：僵尸进程是指它的父进程已经退出(父进程没有等待(调用wait/waitpid)它)，而该进程dead之后没有进程接受，就成为僵尸进程，也就是(zombie)进程
  - kill -18 PPID　(PPID是其父进程)
  - kill –15 PID1 PID2　(PID1,PID2是僵尸进程的父进程的其它子进程)。



lsof：占用文件的进程

- lsof（list open files）是一个列出当前系统打开文件的工具

crontab：计划任务

---

### linux系统的操作

系统安全加固，扫描漏洞，对有漏洞的主栈进行升级

1. 设置复杂密码：服务器设置大写、小写、特殊字符、数字组成的12-16位的复杂密码
2. 设置密码策略：修改文件/etc/login.defs 密码最长有效期；密码修改之间最小的天数
3. 对用户的登录次数进行限制 编辑文件 /etc/pam.d/sshd；am_tally2 查看被锁定的用户
4. 禁止root用户远程登录：修改/etc/ssh/sshd_config
5. 更改ssh端口
6. 设置账户保存历史命令条数，超时时间  /etc/profile 五分钟未动，服务器超时自动断开与客户端的链接
7. 定期备份数据



硬件故障维护，硬盘故障

磁盘扩容：分区扩容工具(fdisk/e2fsck/resize2fs)

---

### web服务

nginx优化，监控，静态页面 和 优化 ，反向代理

zabbix服务端的优化

- 配置优化[进程数和缓存]
- 数据库history表做分表优化

tomcat优化

- jvm优化
- 线程池
- 缓存压缩优化
- 安全优化
- 监控：线程，堆内存，内存池

![img](https://gitee.com/luoxian1011/pictures/raw/master/17001015223849.png)

- 使用jmx来获取到tomcat这类应用的状态，然后再将数据交给server端，生成监控图

```
1、Tomcat开启JMX远程连接
2、安装Zabbix Java Gateway
3、创建JMX主机
```

- JC垃圾回收

apache和nginx的区别[tomcat]



### k8s架构

Kubernetes属于主从分布式架构，主要由Master Node和Worker Node组成，以及包括客户端命令行工具kubectl和其它附加项。

- Master Node：作为控制节点，对集群进行调度管理；Master Node由API Server、Scheduler、Cluster State Store和Controller-Manger Server所组成；
- Worker Node：作为真正的工作节点，运行业务应用的容器；Worker Node包含kubelet、kube proxy和Container Runtime；
- kubectl：用于通过命令行与API Server进行交互，而对Kubernetes进行操作，实现在集群中进行各种资源的增删改查等操作；
- Add-on：是对Kubernetes核心功能的扩展，例如增加网络和网络策略等能力。
- repliceation 用于伸缩副本数量
- endpoint 用于管理网络请求
- scheduler 调度器